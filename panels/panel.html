<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="math-panel">
    <template>

        <style>
            .edge {
                position: absolute;
            }

            .edge.left {
                left: -3px;
                width: 7px;
            }

            .edge.right {
                left: calc(100% - 3px);
                width: 7px;
            }

            .edge.top {
                top: -3px;
                height: 7px;
            }

            .edge.bottom {
                top: calc(100% - 3px);
                height: 7px;
            }

            .edge.top.middle, .edge.bottom.middle {
                width: calc(100% - 4px);
                left: 2px;
                cursor: ns-resize;
            }

            .edge.left.middle, .edge.right.middle {
                height: calc(100% - 8px);
                top: 4px;
                cursor: ew-resize;
            }

            .edge.top.left, .edge.bottom.right {
                cursor: nwse-resize;
            }

            .edge.top.right, .edge.bottom.left {
                cursor: nesw-resize;
            }

            :host {
                min-width: 30px;
                min-height: 30px;
                display: flex;
            }

            :host([orientation="vertical"]) {
                flex-direction: column;
            }

            :host([orientation="horizontal"]) {
                flex-direction: row;
            }

            :host([orientation="vertical"]) .handle {
                height: 20px;
                width: 100%;
                background-color: #444;
            }

            :host([orientation="horizontal"]) .handle {
                width: 20px;
                height: 100%;
                background-color: #444;
            }

            .content {
                background-color: white;
            }

            :host([orientation="vertical"]) .content {
                width: calc(100% - 2px);
                height: calc(100% - 21px);
                border-left: 1px solid #444;
                border-right: 1px solid #444;
                border-bottom: 1px solid #444;
            }

            :host([orientation="horizontal"]) .content {
                height: calc(100% - 2px);
                width: calc(100% - 21px);
                border-top: 1px solid #444;
                border-bottom: 1px solid #444;
                border-right: 1px solid #444;
            }
        </style>
        <div class="edge left middle"></div>
        <div class="edge right middle"></div>
        <div class="edge top middle"></div>
        <div class="edge bottom middle"></div>
        <div class="edge top left"></div>
        <div class="edge top right"></div>
        <div class="edge bottom left"></div>
        <div class="edge bottom right"></div>
        <div class="handle"></div>
        <div class="content">
        </div>
    </template>
    <script src="panel.js"></script>
    <script>
        class MathPanel extends Polymer.Element {
            static get is() {
                return "math-panel";
            }

            static get properties() {
                return {
                    orientation: {
                        type: String
                    }
                }
            }

            ready() {
                super.ready();

                // Update mouse coordinates
                var mouseX = 0;
                var mouseY = 0;
                window.addEventListener("mousemove", function(e) {
                    mouseX = e.x;
                    mouseY = e.y - 20; // 20 is the toolbar height
                });

                // Call callResizePanel() for panel resize
                var children = this.shadowRoot.childNodes;
                var callResizePanel = function(obj, directions) {
                    resizePanel(obj, directions, [mouseX, mouseY, obj.offsetWidth, obj.offsetHeight, matrixToArray(obj.style.transform)[1], matrixToArray(obj.style.transform)[0]]);
                };
                for (var i = children[0].nodeName == "#text" ? 1 : 2; i < children.length; i += 2) { // The ternary operator is there because of a small difference between Firefox and Chrome
                    if (children[i].matches(".edge.top.left")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [true, false, false, true]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.top.middle")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [true, false, false, false]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.top.right")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [true, true, false, false]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.right.middle")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [false, true, false, false]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.right.bottom")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [false, true, true, false]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.bottom.middle")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [false, false, true, false]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.bottom.left")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [false, false, true, true]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".edge.left.middle")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [false, false, false, true]);
                            e.preventDefault();
                        });
                    }
                    if (children[i].matches(".handle")) {
                        children[i].addEventListener("mousedown", function(e) {
                            callResizePanel(this.offsetParent, [true, true, true, true]);
                            e.preventDefault();
                        });
                    }
                }

                if (this.id.search(/^test[0-9]+?/) == -1) {
                    var panel = document.createElement("math-panel-" + this.id.toLowerCase());
                } else {
                    var panel = document.createElement("math-panel-test");
                }
                panel.style.display = "block";
                panel.style.width   = "100%";
                panel.style.height  = "100%";

                var content = children[19].nodeName == "#text" ? children[20] : children[19]; // Handles discrepancies between Chrome and Firefox
                content.appendChild(panel);
            }
        }

        customElements.define(MathPanel.is, MathPanel);
    </script>
</dom-module>
